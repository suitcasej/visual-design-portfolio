{"version":3,"file":"oscilloscope.js","sources":["../src/index.js"],"sourcesContent":["export default class Oscilloscope {\n  constructor (source, options = {}) {\n    if (!(source instanceof window.AudioNode)) {\n      throw new Error('Oscilloscope source must be an AudioNode')\n    }\n\n    if (source instanceof window.AnalyserNode) {\n      this.analyser = source\n    } else {\n      this.analyser = source.context.createAnalyser()\n      source.connect(this.analyser)\n    }\n\n    if (options.fftSize) { this.analyser.fftSize = options.fftSize }\n    this.timeDomain = new Uint8Array(this.analyser.fftSize)\n    this.drawRequest = 0\n  }\n\n  // begin default signal animation\n  animate (ctx, x0, y0, width, height) {\n    if (this.drawRequest) {\n      throw new Error('Oscilloscope animation is already running')\n    }\n    this.ctx = ctx\n    const drawLoop = () => {\n      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)\n      this.draw(ctx, x0, y0, width, height)\n      this.drawRequest = window.requestAnimationFrame(drawLoop)\n    }\n    drawLoop()\n  }\n\n  // stop default signal animation\n  stop () {\n    if (this.drawRequest) {\n      window.cancelAnimationFrame(this.drawRequest)\n      this.drawRequest = 0\n      this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height)\n    }\n  }\n\n  // draw signal\n  draw (ctx, x0 = 0, y0 = 0, width = ctx.canvas.width - x0, height = ctx.canvas.height - y0) {\n    this.analyser.getByteTimeDomainData(this.timeDomain)\n    const step = width / this.timeDomain.length\n\n    ctx.beginPath()\n    // drawing loop (skipping every second record)\n    for (let i = 0; i < this.timeDomain.length; i += 2) {\n      const percent = this.timeDomain[i] / 256\n      const x = x0 + (i * step)\n      const y = y0 + (height * percent)\n      ctx.lineTo(x, y)\n    }\n\n    ctx.stroke()\n  }\n}\n"],"names":["source","options","window","AudioNode","Error","AnalyserNode","this","analyser","context","createAnalyser","connect","fftSize","timeDomain","Uint8Array","drawRequest","animate","ctx","x0","y0","width","height","drawLoop","clearRect","canvas","_this","draw","requestAnimationFrame","stop","cancelAnimationFrame","getByteTimeDomainData","step","length","beginPath","i","lineTo","stroke"],"mappings":"0BACE,WAAaA,EAAQC,GACnB,YADmBA,IAAAA,EAAU,MACvBD,aAAkBE,OAAOC,WAC7B,UAAUC,MAAM,4CAGdJ,aAAkBE,OAAOG,aAC3BC,KAAKC,SAAWP,GAEhBM,KAAKC,SAAWP,EAAOQ,QAAQC,iBAC/BT,EAAOU,QAAQJ,KAAKC,WAGlBN,EAAQU,UAAWL,KAAKC,SAASI,QAAUV,EAAQU,SACvDL,KAAKM,WAAa,IAAIC,WAAWP,KAAKC,SAASI,SAC/CL,KAAKQ,YAAc,6BAIrBC,QAAA,SAASC,EAAKC,EAAIC,EAAIC,EAAOC,cAC3B,GAAId,KAAKQ,YACP,UAAUV,MAAM,6CAElBE,KAAKU,IAAMA,EACM,SAAXK,IACJL,EAAIM,UAAU,EAAG,EAAGN,EAAIO,OAAOJ,MAAOH,EAAIO,OAAOH,QACjDI,EAAKC,KAAKT,EAAKC,EAAIC,EAAIC,EAAOC,GAC9BI,EAAKV,YAAcZ,OAAOwB,sBAAsBL,GAElDA,MAIFM,KAAA,WACMrB,KAAKQ,cACPZ,OAAO0B,qBAAqBtB,KAAKQ,aACjCR,KAAKQ,YAAc,EACnBR,KAAKU,IAAIM,UAAU,EAAG,EAAGhB,KAAKU,IAAIO,OAAOJ,MAAOb,KAAKU,IAAIO,OAAOH,YAKpEK,KAAA,SAAMT,EAAKC,EAAQC,EAAQC,EAA+BC,YAA/CH,IAAAA,EAAK,YAAGC,IAAAA,EAAK,YAAGC,IAAAA,EAAQH,EAAIO,OAAOJ,MAAQF,YAAIG,IAAAA,EAASJ,EAAIO,OAAOH,OAASF,GACrFZ,KAAKC,SAASsB,sBAAsBvB,KAAKM,YACzC,IAAMkB,EAAOX,EAAQb,KAAKM,WAAWmB,OAErCf,EAAIgB,YAEJ,IAAK,IAAIC,EAAI,EAAGA,EAAI3B,KAAKM,WAAWmB,OAAQE,GAAK,EAI/CjB,EAAIkB,OAFMjB,EAAMgB,EAAIH,EACVZ,EAAME,GAFAd,KAAKM,WAAWqB,GAAK,MAMvCjB,EAAImB"}